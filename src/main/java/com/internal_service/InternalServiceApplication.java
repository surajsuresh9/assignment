package com.internal_service;

import com.fasterxml.jackson.core.type.TypeReference;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.internal_service.model.Product;
import com.internal_service.model.Shopper;
import com.internal_service.repo.ProductRepo;
import com.internal_service.repo.ShelfRepo;
import com.internal_service.repo.ShopperRepo;
import lombok.extern.slf4j.Slf4j;
import org.springframework.boot.CommandLineRunner;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.context.annotation.Bean;

import java.util.List;

@SpringBootApplication
@Slf4j
public class InternalServiceApplication {

    public static void main(String[] args) {
        SpringApplication.run(InternalServiceApplication.class, args);
    }

    @Bean
    public CommandLineRunner initializeDB(ProductRepo productRepo, ShelfRepo shelfRepo, ShopperRepo shopperRepo) {
        return args -> {
            List<Product> products = loadProducts();
            products.forEach(product -> productRepo.save(product));
            log.info("Database initialized with Products!");

            List<Shopper> shoppers = loadShopperInfo();
            shoppers.forEach(shopper -> shopperRepo.save(shopper));
            log.info("Database initialized with Shoppers!");
        };
    }

    List<Product> loadProducts() {
        List<Product> products = null;
        try {
            String productJson = "[\r\n  {\r\n    \"productId\": \"BG-419110951\",\r\n    \"category\": \"Babies\",\r\n    \"brand\": \"Girlds\"\r\n  },\r\n  {\r\n    \"productId\": \"BG-419110952\",\r\n    \"category\": \"Babies\",\r\n    \"brand\": \"Girlds\"\r\n  },\r\n  {\r\n    \"productId\": \"BG-419110953\",\r\n    \"category\": \"Babies\",\r\n    \"brand\": \"Girlds\"\r\n  },\r\n  {\r\n    \"productId\": \"BB-2144746855\",\r\n    \"category\": \"Babies\",\r\n    \"brand\": \"Babyom\"\r\n  },\r\n  {\r\n    \"productId\": \"BB-2144746856\",\r\n    \"category\": \"Babies\",\r\n    \"brand\": \"Babyom\"\r\n  },\r\n  {\r\n    \"productId\": \"BB-2144746857\",\r\n    \"category\": \"Babies\",\r\n    \"brand\": \"Babyom\"\r\n  },\r\n  {\r\n    \"productId\": \"BM-1173639537\",\r\n    \"category\": \"Babies\",\r\n    \"brand\": \"Mommers\"\r\n  },\r\n  {\r\n    \"productId\": \"BM-1173639538\",\r\n    \"category\": \"Babies\",\r\n    \"brand\": \"Mommers\"\r\n  },\r\n  {\r\n    \"productId\": \"BM-1173639539\",\r\n    \"category\": \"Babies\",\r\n    \"brand\": \"Mommers\"\r\n  },\r\n  {\r\n    \"productId\": \"BC-989301223\",\r\n    \"category\": \"Babies\",\r\n    \"brand\": \"Childer\"\r\n  },\r\n  {\r\n    \"productId\": \"BC-989301224\",\r\n    \"category\": \"Babies\",\r\n    \"brand\": \"Childer\"\r\n  },\r\n  {\r\n    \"productId\": \"BC-989301225\",\r\n    \"category\": \"Babies\",\r\n    \"brand\": \"Childer\"\r\n  },\r\n  {\r\n    \"productId\": \"MM-749337358\",\r\n    \"category\": \"Milk\",\r\n    \"brand\": \"Milkcask\"\r\n  },\r\n  {\r\n    \"productId\": \"MM-749337359\",\r\n    \"category\": \"Milk\",\r\n    \"brand\": \"Milkcask\"\r\n  },\r\n  {\r\n    \"productId\": \"MM-749337360\",\r\n    \"category\": \"Milk\",\r\n    \"brand\": \"Milkcask\"\r\n  },\r\n  {\r\n    \"productId\": \"MJ-373746709\",\r\n    \"category\": \"Milk\",\r\n    \"brand\": \"Juice\"\r\n  },\r\n  {\r\n    \"productId\": \"MJ-373746710\",\r\n    \"category\": \"Milk\",\r\n    \"brand\": \"Juice\"\r\n  },\r\n  {\r\n    \"productId\": \"MJ-373746711\",\r\n    \"category\": \"Milk\",\r\n    \"brand\": \"Juice\"\r\n  },\r\n  {\r\n    \"productId\": \"MD-543564695\",\r\n    \"category\": \"Milk\",\r\n    \"brand\": \"Dairylounge\"\r\n  },\r\n  {\r\n    \"productId\": \"MD-543564696\",\r\n    \"category\": \"Milk\",\r\n    \"brand\": \"Dairylounge\"\r\n  },\r\n  {\r\n    \"productId\": \"MD-543564697\",\r\n    \"category\": \"Milk\",\r\n    \"brand\": \"Dairylounge\"\r\n  },\r\n  {\r\n    \"productId\": \"MB-2093193397\",\r\n    \"category\": \"Milk\",\r\n    \"brand\": \"Berrycow\"\r\n  },\r\n  {\r\n    \"productId\": \"MB-2093193398\",\r\n    \"category\": \"Milk\",\r\n    \"brand\": \"Berrycow\"\r\n  },\r\n  {\r\n    \"productId\": \"MB-2093193399\",\r\n    \"category\": \"Milk\",\r\n    \"brand\": \"Berrycow\"\r\n  },\r\n  {\r\n    \"productId\": \"ST-348265157\",\r\n    \"category\": \"Sports\",\r\n    \"brand\": \"Trand\"\r\n  },\r\n  {\r\n    \"productId\": \"ST-348265158\",\r\n    \"category\": \"Sports\",\r\n    \"brand\": \"Trand\"\r\n  },\r\n  {\r\n    \"productId\": \"ST-348265159\",\r\n    \"category\": \"Sports\",\r\n    \"brand\": \"Trand\"\r\n  },\r\n  {\r\n    \"productId\": \"SB-51995577\",\r\n    \"category\": \"Sports\",\r\n    \"brand\": \"Ballshop\"\r\n  },\r\n  {\r\n    \"productId\": \"SB-51995578\",\r\n    \"category\": \"Sports\",\r\n    \"brand\": \"Ballshop\"\r\n  },\r\n  {\r\n    \"productId\": \"SB-51995579\",\r\n    \"category\": \"Sports\",\r\n    \"brand\": \"Ballshop\"\r\n  },\r\n  {\r\n    \"productId\": \"SC-860550237\",\r\n    \"category\": \"Sports\",\r\n    \"brand\": \"Crumyard\"\r\n  },\r\n  {\r\n    \"productId\": \"SC-860550238\",\r\n    \"category\": \"Sports\",\r\n    \"brand\": \"Crumyard\"\r\n  },\r\n  {\r\n    \"productId\": \"SC-860550239\",\r\n    \"category\": \"Sports\",\r\n    \"brand\": \"Crumyard\"\r\n  },\r\n  {\r\n    \"productId\": \"SS-1529984359\",\r\n    \"category\": \"Sports\",\r\n    \"brand\": \"Sportf\"\r\n  },\r\n  {\r\n    \"productId\": \"SS-1529984360\",\r\n    \"category\": \"Sports\",\r\n    \"brand\": \"Sportf\"\r\n  },\r\n  {\r\n    \"productId\": \"SS-1529984361\",\r\n    \"category\": \"Sports\",\r\n    \"brand\": \"Sportf\"\r\n  },\r\n  {\r\n    \"productId\": \"VV-1280808854\",\r\n    \"category\": \"Vegan\",\r\n    \"brand\": \"Veganoid\"\r\n  },\r\n  {\r\n    \"productId\": \"VV-1280808855\",\r\n    \"category\": \"Vegan\",\r\n    \"brand\": \"Veganoid\"\r\n  },\r\n  {\r\n    \"productId\": \"VV-1280808856\",\r\n    \"category\": \"Vegan\",\r\n    \"brand\": \"Veganoid\"\r\n  },\r\n  {\r\n    \"productId\": \"VT-246442909\",\r\n    \"category\": \"Vegan\",\r\n    \"brand\": \"Tarcrop\"\r\n  },\r\n  {\r\n    \"productId\": \"VT-246442910\",\r\n    \"category\": \"Vegan\",\r\n    \"brand\": \"Tarcrop\"\r\n  },\r\n  {\r\n    \"productId\": \"VT-246442911\",\r\n    \"category\": \"Vegan\",\r\n    \"brand\": \"Tarcrop\"\r\n  },\r\n  {\r\n    \"productId\": \"VB-1890577306\",\r\n    \"category\": \"Vegan\",\r\n    \"brand\": \"Beanut\"\r\n  },\r\n  {\r\n    \"productId\": \"VB-1890577307\",\r\n    \"category\": \"Vegan\",\r\n    \"brand\": \"Beanut\"\r\n  },\r\n  {\r\n    \"productId\": \"VB-1890577308\",\r\n    \"category\": \"Vegan\",\r\n    \"brand\": \"Beanut\"\r\n  },\r\n  {\r\n    \"productId\": \"VA-1329167330\",\r\n    \"category\": \"Vegan\",\r\n    \"brand\": \"Avocadow\"\r\n  },\r\n  {\r\n    \"productId\": \"VA-1329167331\",\r\n    \"category\": \"Vegan\",\r\n    \"brand\": \"Avocadow\"\r\n  },\r\n  {\r\n    \"productId\": \"VA-1329167332\",\r\n    \"category\": \"Vegan\",\r\n    \"brand\": \"Avocadow\"\r\n  }\r\n]";
            products = new ObjectMapper().readValue(productJson, new TypeReference<List<Product>>() {
            });
        } catch (Exception e) {
            e.printStackTrace();
        }
        return products;
    }

    List<Shopper> loadShopperInfo() {
        List<Shopper> shopperList = null;
        try {
            String inputJson = "[\n  {\n    \"shopperId\": \"S-1000\",\n    \"shelf\": [\n      {\n        \"productId\": \"MB-2093193398\",\n        \"relevancyScore\": 31.089209569320897\n      },\n      {\n        \"productId\": \"VV-1280808856\",\n        \"relevancyScore\": 55.16626010671777\n      },\n      {\n        \"productId\": \"MD-543564697\",\n        \"relevancyScore\": 73.01492966268303\n      },\n      {\n        \"productId\": \"BB-2144746855\",\n        \"relevancyScore\": 4.465418091552332\n      },\n      {\n        \"productId\": \"MB-2093193397\",\n        \"relevancyScore\": 81.86596372052234\n      },\n      {\n        \"productId\": \"SC-860550238\",\n        \"relevancyScore\": 80.39179367642213\n      },\n      {\n        \"productId\": \"BG-419110952\",\n        \"relevancyScore\": 17.06951788069343\n      },\n      {\n        \"productId\": \"BM-1173639537\",\n        \"relevancyScore\": 67.02308880778921\n      },\n      {\n        \"productId\": \"MJ-373746710\",\n        \"relevancyScore\": 5.732323263667915\n      },\n      {\n        \"productId\": \"SS-1529984359\",\n        \"relevancyScore\": 82.6173683756812\n      },\n      {\n        \"productId\": \"MJ-373746711\",\n        \"relevancyScore\": 83.6325837366619\n      },\n      {\n        \"productId\": \"BC-989301224\",\n        \"relevancyScore\": 6.778058627746741\n      },\n      {\n        \"productId\": \"BB-2144746857\",\n        \"relevancyScore\": 85.39314011525776\n      },\n      {\n        \"productId\": \"VA-1329167330\",\n        \"relevancyScore\": 67.76365858050977\n      },\n      {\n        \"productId\": \"SB-51995577\",\n        \"relevancyScore\": 46.014451739635916\n      }\n    ]\n  },\n  {\n    \"shopperId\": \"S-1001\",\n    \"shelf\": [\n      {\n        \"productId\": \"MD-543564695\",\n        \"relevancyScore\": 64.9399444667783\n      },\n      {\n        \"productId\": \"BB-2144746857\",\n        \"relevancyScore\": 53.57797793220851\n      },\n      {\n        \"productId\": \"VT-246442909\",\n        \"relevancyScore\": 21.288534107744482\n      },\n      {\n        \"productId\": \"VA-1329167330\",\n        \"relevancyScore\": 27.014437875539265\n      },\n      {\n        \"productId\": \"SS-1529984359\",\n        \"relevancyScore\": 62.1324134409292\n      },\n      {\n        \"productId\": \"BM-1173639539\",\n        \"relevancyScore\": 44.137367556050236\n      },\n      {\n        \"productId\": \"MM-749337360\",\n        \"relevancyScore\": 6.856912727184749\n      },\n      {\n        \"productId\": \"ST-348265157\",\n        \"relevancyScore\": 39.775934624141605\n      },\n      {\n        \"productId\": \"VB-1890577308\",\n        \"relevancyScore\": 96.8131613220743\n      },\n      {\n        \"productId\": \"BG-419110953\",\n        \"relevancyScore\": 4.430050876459301\n      },\n      {\n        \"productId\": \"VT-246442911\",\n        \"relevancyScore\": 99.38024632323383\n      },\n      {\n        \"productId\": \"VV-1280808854\",\n        \"relevancyScore\": 2.4611321887394677\n      },\n      {\n        \"productId\": \"MM-749337358\",\n        \"relevancyScore\": 24.346224227541345\n      },\n      {\n        \"productId\": \"MM-749337359\",\n        \"relevancyScore\": 58.574240950900524\n      },\n      {\n        \"productId\": \"MD-543564696\",\n        \"relevancyScore\": 37.505474308360355\n      }\n    ]\n  },\n  {\n    \"shopperId\": \"S-1002\",\n    \"shelf\": [\n      {\n        \"productId\": \"VA-1329167330\",\n        \"relevancyScore\": 19.492734899351294\n      },\n      {\n        \"productId\": \"BB-2144746855\",\n        \"relevancyScore\": 52.970581137195005\n      },\n      {\n        \"productId\": \"SB-51995577\",\n        \"relevancyScore\": 71.96790001671006\n      },\n      {\n        \"productId\": \"SC-860550238\",\n        \"relevancyScore\": 43.95637045922845\n      },\n      {\n        \"productId\": \"ST-348265158\",\n        \"relevancyScore\": 63.53588332610439\n      },\n      {\n        \"productId\": \"VB-1890577306\",\n        \"relevancyScore\": 28.318408103977355\n      },\n      {\n        \"productId\": \"MD-543564697\",\n        \"relevancyScore\": 96.8270084353957\n      },\n      {\n        \"productId\": \"VV-1280808855\",\n        \"relevancyScore\": 9.605985097277658\n      },\n      {\n        \"productId\": \"MM-749337358\",\n        \"relevancyScore\": 51.47881070494537\n      },\n      {\n        \"productId\": \"MB-2093193399\",\n        \"relevancyScore\": 97.79320043226103\n      },\n      {\n        \"productId\": \"BC-989301223\",\n        \"relevancyScore\": 22.951332705537688\n      },\n      {\n        \"productId\": \"BG-419110953\",\n        \"relevancyScore\": 42.45475417967195\n      },\n      {\n        \"productId\": \"MD-543564695\",\n        \"relevancyScore\": 81.82907115868066\n      },\n      {\n        \"productId\": \"SS-1529984359\",\n        \"relevancyScore\": 20.116106438128845\n      },\n      {\n        \"productId\": \"MB-2093193398\",\n        \"relevancyScore\": 91.64193020313606\n      }\n    ]\n  },\n  {\n    \"shopperId\": \"S-1003\",\n    \"shelf\": [\n      {\n        \"productId\": \"MM-749337359\",\n        \"relevancyScore\": 9.285784508856453\n      },\n      {\n        \"productId\": \"VB-1890577308\",\n        \"relevancyScore\": 42.69865877013647\n      },\n      {\n        \"productId\": \"BB-2144746855\",\n        \"relevancyScore\": 51.652597645133206\n      },\n      {\n        \"productId\": \"VB-1890577306\",\n        \"relevancyScore\": 53.549240984667016\n      },\n      {\n        \"productId\": \"BG-419110952\",\n        \"relevancyScore\": 60.062975207288915\n      },\n      {\n        \"productId\": \"BM-1173639539\",\n        \"relevancyScore\": 63.844337249273266\n      },\n      {\n        \"productId\": \"SC-860550238\",\n        \"relevancyScore\": 12.045177782886729\n      },\n      {\n        \"productId\": \"MM-749337360\",\n        \"relevancyScore\": 62.348573774809225\n      },\n      {\n        \"productId\": \"VT-246442911\",\n        \"relevancyScore\": 19.421445338673916\n      },\n      {\n        \"productId\": \"SB-51995578\",\n        \"relevancyScore\": 50.23350517638963\n      },\n      {\n        \"productId\": \"BC-989301225\",\n        \"relevancyScore\": 76.10965733312545\n      },\n      {\n        \"productId\": \"BB-2144746856\",\n        \"relevancyScore\": 3.668377020508895\n      },\n      {\n        \"productId\": \"BM-1173639537\",\n        \"relevancyScore\": 65.53309644268158\n      },\n      {\n        \"productId\": \"MM-749337358\",\n        \"relevancyScore\": 99.01865852867185\n      },\n      {\n        \"productId\": \"BC-989301223\",\n        \"relevancyScore\": 1.0846539140113576\n      },\n      {\n        \"productId\": \"BG-1162366999\",\n        \"relevancyScore\": 30.737805376096695\n      }\n    ]\n  },\n  {\n    \"shopperId\": \"S-1004\",\n    \"shelf\": [\n      {\n        \"productId\": \"BM-1173639537\",\n        \"relevancyScore\": 87.44404516029063\n      },\n      {\n        \"productId\": \"VB-1890577307\",\n        \"relevancyScore\": 82.79179867042755\n      },\n      {\n        \"productId\": \"VT-246442909\",\n        \"relevancyScore\": 73.9644416081247\n      },\n      {\n        \"productId\": \"BB-2144746855\",\n        \"relevancyScore\": 69.42747936618181\n      },\n      {\n        \"productId\": \"VB-1890577308\",\n        \"relevancyScore\": 25.81144046082404\n      },\n      {\n        \"productId\": \"ST-348265157\",\n        \"relevancyScore\": 80.35799873926712\n      },\n      {\n        \"productId\": \"MB-2093193397\",\n        \"relevancyScore\": 38.30020871138008\n      },\n      {\n        \"productId\": \"MD-543564696\",\n        \"relevancyScore\": 53.008430263420216\n      },\n      {\n        \"productId\": \"MJ-373746709\",\n        \"relevancyScore\": 38.108616670630326\n      },\n      {\n        \"productId\": \"VA-1329167332\",\n        \"relevancyScore\": 31.61708483693215\n      },\n      {\n        \"productId\": \"SS-1529984359\",\n        \"relevancyScore\": 36.0226464541305\n      },\n      {\n        \"productId\": \"MB-2093193399\",\n        \"relevancyScore\": 66.72664648565359\n      },\n      {\n        \"productId\": \"BC-989301225\",\n        \"relevancyScore\": 2.5494342826014704\n      },\n      {\n        \"productId\": \"MD-543564695\",\n        \"relevancyScore\": 91.11862453341534\n      },\n      {\n        \"productId\": \"SC-860550237\",\n        \"relevancyScore\": 18.570109269156355\n      },\n      {\n        \"productId\": \"SC-860550237\",\n        \"relevancyScore\": 30.737805376096695\n      }\n    ]\n  }\n]";
            shopperList = new ObjectMapper().readValue(inputJson, new TypeReference<List<Shopper>>() {
            });
        } catch (Exception e) {
            e.printStackTrace();
        }
        return shopperList;
    }
}
